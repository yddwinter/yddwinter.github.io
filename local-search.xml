<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>CRM商机阶段推进更新序时一客一单率</title>
    <link href="/2022/10/13/CRM%E5%95%86%E6%9C%BA%E9%98%B6%E6%AE%B5%E6%8E%A8%E8%BF%9B%E6%9B%B4%E6%96%B0%E5%BA%8F%E6%97%B6%E4%B8%80%E5%AE%A2%E4%B8%80%E5%8D%95%E7%8E%87/"/>
    <url>/2022/10/13/CRM%E5%95%86%E6%9C%BA%E9%98%B6%E6%AE%B5%E6%8E%A8%E8%BF%9B%E6%9B%B4%E6%96%B0%E5%BA%8F%E6%97%B6%E4%B8%80%E5%AE%A2%E4%B8%80%E5%8D%95%E7%8E%87/</url>
    
    <content type="html"><![CDATA[<style>.center {  width: auto;  display: table;  margin-left: auto;  margin-right: auto;}</style><h2 id="一、需求背景"><a href="#一、需求背景" class="headerlink" title="一、需求背景"></a>一、需求背景</h2><p>销售部门在<strong>工程项目型商机推进流程</strong>中增加了<strong>序时一客一单率</strong>字段，用来衡量销售员对商机的跟进速度，作为绩效考核的依据。<br>具体是用根据不同的<strong>商机阶段</strong>，用<strong>一客一单完成率</strong>除以不同的比例，计算规则如下：</p><div class="center"><table><thead><tr><th align="center">商机阶段</th><th align="center">除以比例</th></tr></thead><tbody><tr><td align="center">商机立项</td><td align="center">18%</td></tr><tr><td align="center">标前引导</td><td align="center">62%</td></tr><tr><td align="center">解决方案与投标</td><td align="center">93%</td></tr><tr><td align="center">合同谈判与签订</td><td align="center">100%</td></tr></tbody></table></div><h2 id="二、问题分析"><a href="#二、问题分析" class="headerlink" title="二、问题分析"></a>二、问题分析</h2><p>销售人员填写<strong>销售行动记录</strong>会重新计算<strong>一客一单完成率</strong>，这时<strong>序时一客一单率</strong>也要相应重新计算；<br>销售人员将商机推进到下一阶段，表单<strong>商机阶段</strong>的值会变化,<strong>序时一客一单率</strong>要重新计算。</p><h2 id="三、问题解决"><a href="#三、问题解决" class="headerlink" title="三、问题解决"></a>三、问题解决</h2><ol><li>编写APL函数<br></li></ol><p>  <img src="/.io//1.jpg" alt="创建页面"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> 系统管理员</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@codeName</span> 【工作流】商机阶段变更触发</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@description</span> 【工作流】商机阶段变更触发</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@createTime</span> 2022-09-29</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">Map</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> context.data as Map;<br><br><span class="hljs-type">BigDecimal</span> <span class="hljs-variable">ykydwcl</span> <span class="hljs-operator">=</span> map.field_9kaOd__c as BigDecimal;<span class="hljs-comment">//一客一单完成率</span><br>log.info(<span class="hljs-string">&quot;一客一单完成率&quot;</span> + ykydwcl)<br><span class="hljs-type">BigDecimal</span> <span class="hljs-variable">xsykydl</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.00</span>; <span class="hljs-comment">// 序时一客一单率</span><br><br><span class="hljs-type">String</span> <span class="hljs-variable">sales_stage_str</span> <span class="hljs-operator">=</span> map.sales_stage as String;<br>log.info(<span class="hljs-string">&quot;当前商机阶段&quot;</span> + sales_stage_str);<br><br>Integer sales_stage;<br><span class="hljs-keyword">if</span>(!sales_stage_str.startsWith(<span class="hljs-string">&quot;e&quot;</span>))&#123;<br>  sales_stage = map.sales_stage as Integer;<br>  <br>  <span class="hljs-keyword">if</span>(ykydwcl !=<span class="hljs-literal">null</span> )&#123;<br>  <span class="hljs-keyword">if</span>(sales_stage==<span class="hljs-number">1</span>)&#123;<br>    xsykydl = ykydwcl/<span class="hljs-number">0.18</span>;<br>    log.info(<span class="hljs-string">&quot;除以18%&quot;</span>);<br>  &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( sales_stage==<span class="hljs-number">2</span>)&#123;<br>    xsykydl = ykydwcl/<span class="hljs-number">0.62</span>;<br>    log.info(<span class="hljs-string">&quot;除以62%&quot;</span>);<br>  &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( sales_stage==<span class="hljs-number">3</span>)&#123;<br>    xsykydl = ykydwcl/<span class="hljs-number">0.93</span>;<br>    log.info(<span class="hljs-string">&quot;除以93%&quot;</span>);<br>  &#125;<span class="hljs-keyword">else</span>&#123;<br>    xsykydl = ykydwcl;<br>  &#125;<br>&#125;<br>  <br>&#125;<br><br>log.info(<span class="hljs-string">&quot;序时一客一单率&quot;</span> + xsykydl);<br><br>def (error, data, errorMessage) = Fx.object.update(<span class="hljs-string">&quot;NewOpportunityObj&quot;</span>,(map._id as String),[<span class="hljs-string">&quot;field_h9j14__c&quot;</span>:xsykydl])<br><span class="hljs-keyword">if</span>(error==<span class="hljs-literal">false</span>)&#123;<br>  log.info(<span class="hljs-string">&quot;更新成功！&quot;</span>)<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>  log.info(<span class="hljs-string">&quot;更新失败！&quot;</span>+errorMessage)<br>&#125;<br></code></pre></td></tr></table></figure><ol><li>配置工作流</li></ol>]]></content>
    
    
    <categories>
      
      <category>CRM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Groovy</tag>
      
      <tag>工作流</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
